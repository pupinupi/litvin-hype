<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Litvin Hype</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="startScreen">
  <h2>Litvin Hype</h2>
  <input id="nameInput" placeholder="–ò–º—è">
  <input id="roomInput" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">

  <div id="colors">
    <div class="choice" data-color="red" style="background:red;"></div>
    <div class="choice" data-color="blue" style="background:blue;"></div>
    <div class="choice" data-color="green" style="background:green;"></div>
    <div class="choice" data-color="yellow" style="background:yellow;"></div>
  </div>

  <button id="joinBtn">–í–æ–π—Ç–∏</button>
</div>

<div id="gameScreen">
  <div id="board">
    <div id="tokenLayer"></div>
  </div>

  <div id="diceArea">
    <div id="diceDisplay">üé≤</div>
    <button id="rollBtn">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
  </div>

  <div id="info"></div>
</div>

<div id="winnerModal">
  <div class="modalBox">
    <h2 id="winnerText"></h2>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let myRoom;
let selectedColor;
let currentState;

const positions = [
{ x:113,y:588},{ x:108,y:464},{ x:108,y:345},{ x:108,y:235},{ x:108,y:135},
{ x:232,y:83},{ x:359,y:88},{ x:511,y:91},{ x:660,y:88},{ x:798,y:88},
{ x:920,y:119},{ x:903,y:243},{ x:901,y:351},{ x:895,y:461},{ x:895,y:580},
{ x:776,y:610},{ x:644,y:602},{ x:514,y:602},{ x:365,y:599},{ x:224,y:605}
];

document.querySelectorAll(".choice").forEach(c=>{
  c.onclick=()=>{
    document.querySelectorAll(".choice").forEach(x=>x.classList.remove("selected"));
    c.classList.add("selected");
    selectedColor=c.dataset.color;
  };
});

document.getElementById("joinBtn").onclick=()=>{
  const name=document.getElementById("nameInput").value;
  const room=document.getElementById("roomInput").value;

  if(!name||!room||!selectedColor){ alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å—ë"); return; }

  myRoom=room;
  socket.emit("joinRoom",{name,room,color:selectedColor});

  startScreen.style.display="none";
  gameScreen.style.display="block";
};

socket.on("updateState",state=>{
  currentState=state;
  render();
});

socket.on("diceResult",num=>{
  document.getElementById("diceDisplay").innerHTML="üé≤ "+num;
});

socket.on("winner",name=>{
  winnerModal.style.display="flex";
  winnerText.innerText=name+" –ø–æ–±–µ–¥–∏–ª!";
});

function render(){
  const layer=document.getElementById("tokenLayer");
  layer.innerHTML="";

  currentState.players.forEach((p,i)=>{
    const token=document.createElement("div");
    token.className="token";
    token.style.background=p.color;
    token.style.transform=`translate(${positions[p.position].x}px,${positions[p.position].y}px)`;
    layer.appendChild(token);
  });

  const current=currentState.players[currentState.turn];
  info.innerHTML="–•–æ–¥–∏—Ç: "+current.name;
}

document.getElementById("rollBtn").onclick=()=>{
  socket.emit("rollDice",myRoom);
};
</script>

</body>
</html>
