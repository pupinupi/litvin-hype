<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ð›Ð¸Ñ‚Ð²Ð¸Ð½. ÐŸÑƒÑ‚ÑŒ Ðº Ñ…Ð°Ð¹Ð¿Ñƒ</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="start">
  <h2>Ð›Ð¸Ñ‚Ð²Ð¸Ð½. ÐŸÑƒÑ‚ÑŒ Ðº Ñ…Ð°Ð¹Ð¿Ñƒ</h2>
  <input id="name" placeholder="Ð˜Ð¼Ñ"><br>
  <input id="room" placeholder="ÐšÐ¾Ð´ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹"><br>

  <div>
    <div class="choice" data-color="red" style="background:red"></div>
    <div class="choice" data-color="blue" style="background:blue"></div>
    <div class="choice" data-color="green" style="background:green"></div>
    <div class="choice" data-color="yellow" style="background:yellow"></div>
  </div>

  <button onclick="enter()">Ð’Ð¾Ð¹Ñ‚Ð¸</button>
</div>

<div id="game" style="display:none">
  <div id="board">
    <img src="board.jpg" class="board-img">
  </div>
  <div id="dice">ðŸŽ²</div>
  <div id="info"></div>
</div>

<div id="popup"></div>

<script src="/socket.io/socket.io.js"></<script>

  const socket = io();

let myId = null;
let myColor = null;

const board = document.getElementById("board");
const diceBtn = document.getElementById("rollBtn");
const diceBox = document.getElementById("diceBox");

const cellPositions = [
  {x:60,y:540},{x:60,y:480},{x:60,y:420},{x:60,y:360},{x:60,y:300},
  {x:60,y:240},{x:60,y:180},{x:60,y:120},{x:60,y:60},{x:120,y:60},
  {x:180,y:60},{x:240,y:60},{x:300,y:60},{x:360,y:60},{x:420,y:60},
  {x:480,y:60},{x:540,y:60},{x:540,y:120},{x:540,y:180},{x:540,y:240}
];

function createToken(id,color){
  let el = document.createElement("div");
  el.className = "token";
  el.id = "player-"+id;
  el.style.background = color;
  board.appendChild(el);
}

function moveToken(id,pos){
  let el = document.getElementById("player-"+id);
  if(!el) return;
  let p = cellPositions[pos];
  el.style.transform = `translate(${p.x}px,${p.y}px)`;
}

socket.on("init", data=>{
  myId = data.id;
  myColor = data.color;
  createToken(myId,myColor);
  moveToken(myId,0);
});

socket.on("updatePlayers", players=>{
  players.forEach(p=>{
    if(!document.getElementById("player-"+p.id)){
      createToken(p.id,p.color);
    }
    moveToken(p.id,p.position);
  });
});

diceBtn.onclick = ()=>{
  socket.emit("rollDice");
};

socket.on("diceResult", num=>{
  animateDice(num);
});

function animateDice(num){
  let count = 0;
  let interval = setInterval(()=>{
    diceBox.innerHTML = Math.floor(Math.random()*6)+1;
    count++;
    if(count>10){
      clearInterval(interval);
      diceBox.innerHTML = num;
    }
  },100);
}
</script>
</body>
</html>
