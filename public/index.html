<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Litvin Hype ULTIMATE</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="start">
<h2>Litvin Hype</h2>

<input id="nameInput" placeholder="–ò–º—è">
<input id="roomInput" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">

<div id="colors">
<div class="choice" data-color="red" style="background:red;"></div>
<div class="choice" data-color="blue" style="background:blue;"></div>
<div class="choice" data-color="green" style="background:green;"></div>
<div class="choice" data-color="yellow" style="background:yellow;"></div>
</div>

<button id="joinBtn">–ò–≥—Ä–∞—Ç—å</button>
</div>

<div id="game" style="display:none;">
<div id="board">
<img src="board.jpg" id="boardImg">
<div id="tokens"></div>
<div id="highlight"></div>
</div>

<div id="diceSection">
<div id="dice3d">
<div class="cube" id="cube">
<div class="face front">‚öÄ</div>
<div class="face back">‚öÖ</div>
<div class="face right">‚öÇ</div>
<div class="face left">‚öÉ</div>
<div class="face top">‚öÅ</div>
<div class="face bottom">‚öÑ</div>

<div class="face front">1</div>
<div class="face back">6</div>
<div class="face right">3</div>
<div class="face left">4</div>
<div class="face top">2</div>
<div class="face bottom">5</div>
</div>
</div>
<button id="rollBtn">–ë—Ä–æ—Å–∏—Ç—å</button>
</div>
<div class="cube" id="cube">
<div class="face front">‚öÄ</div>
<div class="face back">‚öÖ</div>
<div class="face right">‚öÇ</div>
<div class="face left">‚öÉ</div>
<div class="face top">‚öÅ</div>
<div class="face bottom">‚öÑ</div>
</div>
<div id="info"></div>
</div>

<div id="modal"></div>

<script src="/socket.io/socket.io.js"></script>
<script>

const socket = io();

let myRoom = null;
let selectedColor = null;
let state = null;
let animating = false;

const positions = [
{ x:113,y:588},{ x:108,y:464},{ x:108,y:345},{ x:108,y:235},{ x:108,y:135},
{ x:232,y:83},{ x:359,y:88},{ x:511,y:91},{ x:660,y:88},{ x:798,y:88},
{ x:920,y:119},{ x:903,y:243},{ x:901,y:351},{ x:895,y:461},{ x:895,y:580},
{ x:776,y:610},{ x:644,y:602},{ x:514,y:602},{ x:365,y:599},{ x:224,y:605}
];

const startScreen = document.getElementById("start");
const gameScreen = document.getElementById("game");
const nameInput = document.getElementById("nameInput");
const roomInput = document.getElementById("roomInput");
const joinBtn = document.getElementById("joinBtn");
const rollBtn = document.getElementById("rollBtn");
const infoBox = document.getElementById("info");
const modal = document.getElementById("modal");

// –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
document.querySelectorAll(".choice").forEach(c=>{
  c.onclick = ()=>{
    document.querySelectorAll(".choice").forEach(x=>x.classList.remove("sel"));
    c.classList.add("sel");
    selectedColor = c.getAttribute("data-color");
  };
});

// –≤—Ö–æ–¥
joinBtn.onclick = ()=>{
  const nameVal = nameInput.value.trim();
  const roomVal = roomInput.value.trim();

  if(!nameVal || !roomVal || !selectedColor){
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å—ë");
    return;
  }

  myRoom = roomVal;

  socket.emit("joinRoom",{
    name: nameVal,
    room: roomVal,
    color: selectedColor
  });

  startScreen.style.display="none";
  gameScreen.style.display="block";
};

socket.on("state", s=>{
  state = s;
  render();
});

function render(){

  const layer = document.getElementById("tokens");
  layer.innerHTML="";

  state.players.forEach(p=>{
    const token=document.createElement("div");
    token.className="token";
    token.style.background=p.color;
    token.style.transform=`translate(${positions[p.position].x}px,${positions[p.position].y}px)`;
    layer.appendChild(token);
  });

  let html="<h3>–ò–≥—Ä–æ–∫–∏:</h3>";
  state.players.forEach(p=>{
    html+=`<div><span style="color:${p.color}">${p.name}</span> ‚Äî ${p.hype} —Ö–∞–π–ø</div>`;
  });

  const current=state.players[state.turn];
  html+=`<hr>–•–æ–¥–∏—Ç: ${current.name}`;

  infoBox.innerHTML=html;

  rollBtn.disabled=(current.id!==socket.id)||animating;
}

// –∫—É–±–∏–∫
function rotateCube(num){
  const cube=document.getElementById("cube");
  const map={
    1:"rotateX(0deg) rotateY(0deg)",
    2:"rotateX(-90deg)",
    3:"rotateY(-90deg)",
    4:"rotateY(90deg)",
    5:"rotateX(90deg)",
    6:"rotateX(180deg)"
  };
  cube.style.transform=map[num];
}

rollBtn.onclick=()=>{
  socket.emit("rollDice", myRoom);
};

socket.on("roll", num=>{
  rotateCube(num);
});

// —Å–∫–∞–Ω–¥–∞–ª
socket.on("scandal", text=>{
  modal.innerHTML=`
    <div class="modalBox">
      <h2>–°–ö–ê–ù–î–ê–õ</h2>
      <p>${text}</p>
      <button onclick="document.getElementById('modal').style.display='none'">–û–ö</button>
    </div>
  `;
  modal.style.display="flex";
});

// –ø–æ–±–µ–¥–∞
socket.on("winner", name=>{
  modal.innerHTML=`
    <div class="modalBox">
      <h1>${name} –ø–æ–±–µ–¥–∏–ª! üèÜ</h1>
      <button onclick="location.reload()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>
  `;
  modal.style.display="flex";
});

</script>
</body>
</html>
