<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Litvin Hype</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="startScreen">
  <h2>–í—Ö–æ–¥ –≤ –∏–≥—Ä—É</h2>
  <input id="nameInput" placeholder="–ò–º—è">

  <div id="colors">
    <div class="choice" data-color="red" style="background:red;"></div>
    <div class="choice" data-color="blue" style="background:blue;"></div>
    <div class="choice" data-color="green" style="background:green;"></div>
    <div class="choice" data-color="yellow" style="background:yellow;"></div>
  </div>

  <button id="joinBtn">–ò–≥—Ä–∞—Ç—å</button>
</div>

<div id="gameScreen" style="display:none;">
  <div id="board">
    <div id="diceArea">
      <div id="dice">üé≤</div>
      <button id="rollBtn">–ë—Ä–æ—Å–∏—Ç—å</button>
    </div>
  </div>
  <div id="info"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

let myId = null;
let selectedColor = null;

const startScreen = document.getElementById("startScreen");
const gameScreen = document.getElementById("gameScreen");
const joinBtn = document.getElementById("joinBtn");
const nameInput = document.getElementById("nameInput");
const choices = document.querySelectorAll(".choice");
const board = document.getElementById("board");
const dice = document.getElementById("dice");
const rollBtn = document.getElementById("rollBtn");
const info = document.getElementById("info");

choices.forEach(c=>{
  c.onclick = ()=>{
    choices.forEach(x=>x.classList.remove("selected"));
    c.classList.add("selected");
    selectedColor = c.dataset.color;
  }
});

joinBtn.onclick = ()=>{
  if(!nameInput.value || !selectedColor){
    alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç");
    return;
  }
  socket.emit("joinGame",{name:nameInput.value,color:selectedColor});
  startScreen.style.display="none";
  gameScreen.style.display="block";
};

const positions = [
  {x:60,y:540},{x:60,y:480},{x:60,y:420},{x:60,y:360},{x:60,y:300},
  {x:60,y:240},{x:60,y:180},{x:60,y:120},{x:60,y:60},{x:120,y:60},
  {x:180,y:60},{x:240,y:60},{x:300,y:60},{x:360,y:60},{x:420,y:60},
  {x:480,y:60},{x:540,y:60},{x:540,y:120},{x:540,y:180},{x:540,y:240}
];

function createToken(id,color){
  let el = document.createElement("div");
  el.className="token";
  el.id="p"+id;
  el.style.background=color;
  board.appendChild(el);
}

function moveToken(id,pos){
  let el=document.getElementById("p"+id);
  if(!el) return;
  el.style.transform=`translate(${positions[pos].x}px,${positions[pos].y}px)`;
}

socket.on("init",data=>{
  myId=data.id;
});

socket.on("updatePlayers",players=>{
  players.forEach(p=>{
    if(!document.getElementById("p"+p.id)){
      createToken(p.id,p.color);
    }
    moveToken(p.id,p.position);
    if(p.id===myId){
      info.innerHTML="–•–∞–π–ø: "+p.hype;
    }
  });
});

rollBtn.onclick=()=>{
  socket.emit("rollDice");
};

socket.on("diceResult",num=>{
  let i=0;
  let anim=setInterval(()=>{
    dice.innerHTML=Math.floor(Math.random()*6)+1;
    i++;
    if(i>10){
      clearInterval(anim);
      dice.innerHTML=num;
    }
  },100);
});
</script>
</body>
</html>
