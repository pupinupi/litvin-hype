<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Litvin Hype ULTIMATE</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="start">
<h2>Litvin Hype</h2>
<input id="name" placeholder="–ò–º—è">
<input id="room" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">

<div id="colors">
<div class="choice" data="red" style="background:red;"></div>
<div class="choice" data="blue" style="background:blue;"></div>
<div class="choice" data="green" style="background:green;"></div>
<div class="choice" data="yellow" style="background:yellow;"></div>
</div>

<button id="join">–ò–≥—Ä–∞—Ç—å</button>
</div>

<div id="game">
<div id="board">
<div id="tokens"></div>
</div>

<div id="diceBox">
<div id="dice" class="cube">
<div class="face one">1</div>
<div class="face two">2</div>
<div class="face three">3</div>
<div class="face four">4</div>
<div class="face five">5</div>
<div class="face six">6</div>
</div>
<button id="rollBtn">–ë—Ä–æ—Å–∏—Ç—å</button>
</div>

<div id="info"></div>
</div>

<div id="modal"></div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket=io();
let myRoom,selectedColor,state;

const positions=[
{ x:113,y:588},{ x:108,y:464},{ x:108,y:345},{ x:108,y:235},{ x:108,y:135},
{ x:232,y:83},{ x:359,y:88},{ x:511,y:91},{ x:660,y:88},{ x:798,y:88},
{ x:920,y:119},{ x:903,y:243},{ x:901,y:351},{ x:895,y:461},{ x:895,y:580},
{ x:776,y:610},{ x:644,y:602},{ x:514,y:602},{ x:365,y:599},{ x:224,y:605}
];

document.querySelectorAll(".choice").forEach(c=>{
c.onclick=()=>{
document.querySelectorAll(".choice").forEach(x=>x.classList.remove("sel"));
c.classList.add("sel");
selectedColor=c.dataset;
};
});

join.onclick=()=>{
const nameVal=name.value;
const roomVal=room.value;
if(!nameVal||!roomVal||!selectedColor) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å—ë");

myRoom=roomVal;
socket.emit("joinRoom",{name:nameVal,room:roomVal,color:selectedColor});
start.style.display="none";
game.style.display="block";
};

socket.on("state",s=>{
state=s;
render();
});

socket.on("roll",num=>{
animateDice(num);
});

socket.on("scandal",text=>{
modal.innerHTML="<div class='box'>"+text+"<br><button onclick='modal.style.display=\"none\"'>OK</button></div>";
modal.style.display="flex";
});

socket.on("winner",name=>{
modal.innerHTML="<div class='box'>"+name+" –ø–æ–±–µ–¥–∏–ª! üèÜ</div>";
modal.style.display="flex";
});

function render(){
tokens.innerHTML="";
state.players.forEach(p=>{
const t=document.createElement("div");
t.className="token";
t.style.background=p.color;
animateMove(t,p.position);
tokens.appendChild(t);
});
info.innerHTML="–•–æ–¥–∏—Ç: "+state.players[state.turn].name;
rollBtn.disabled=(state.players[state.turn].id!==socket.id);
}

function animateMove(el,pos){
el.style.transform=`translate(${positions[pos].x}px,${positions[pos].y}px)`;
}

rollBtn.onclick=()=>socket.emit("rollDice",myRoom);

function animateDice(num){
const cube=document.getElementById("dice");
cube.style.transform="rotateX("+(num*90)+"deg)";
}
</script>

</body>
</html>
