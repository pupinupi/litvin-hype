<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Litvin Hype</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="startScreen">
  <h2>–í—Ö–æ–¥ –≤ –∏–≥—Ä—É</h2>
  <input id="nameInput" placeholder="–ò–º—è">

  <div id="colors">
    <div class="choice" data-color="red" style="background:red;"></div>
    <div class="choice" data-color="blue" style="background:blue;"></div>
    <div class="choice" data-color="green" style="background:green;"></div>
    <div class="choice" data-color="yellow" style="background:yellow;"></div>
  </div>

  <button id="joinBtn">–ò–≥—Ä–∞—Ç—å</button>
</div>

<div id="gameScreen" style="display:none;">

  <div id="boardWrapper">
    <div id="board"></div>
  </div>

  <div id="diceArea">
    <div id="dice">üé≤</div>
    <button id="rollBtn">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
  </div>

  <div id="info">–•–∞–π–ø: 0</div>

</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

let myId = null;
let selectedColor = null;

const startScreen = document.getElementById("startScreen");
const gameScreen = document.getElementById("gameScreen");
const joinBtn = document.getElementById("joinBtn");
const nameInput = document.getElementById("nameInput");
const choices = document.querySelectorAll(".choice");
const board = document.getElementById("board");
const dice = document.getElementById("dice");
const rollBtn = document.getElementById("rollBtn");
const info = document.getElementById("info");

choices.forEach(c=>{
  c.onclick = ()=>{
    choices.forEach(x=>x.classList.remove("selected"));
    c.classList.add("selected");
    selectedColor = c.dataset.color;
  }
});

joinBtn.onclick = ()=>{
  if(!nameInput.value || !selectedColor){
    alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç");
    return;
  }
  socket.emit("joinGame",{name:nameInput.value,color:selectedColor});
  startScreen.style.display="none";
  gameScreen.style.display="block";
};

socket.on("init",data=>{
  myId=data.id;
});

/*
  –í–ê–ñ–ù–û:
  –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–¥ —Ç–≤–æ—ë —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
  –î–≤–∏–∂–µ–Ω–∏–µ: —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö ‚Üí –≤–ø—Ä–∞–≤–æ ‚Üí –≤–Ω–∏–∑ ‚Üí –≤–ª–µ–≤–æ
*/

const positions = [

  // –ù–ò–ñ–ù–ò–ô –õ–ï–í–´–ô –£–ì–û–õ (–°–¢–ê–†–¢)
  {x:110,y:520}, // 0 START

  // –õ–ï–í–ê–Ø –°–¢–û–†–û–ù–ê –í–í–ï–†–•
  {x:110,y:450},
  {x:110,y:380},
  {x:110,y:310},
  {x:110,y:240},

  // –í–ï–†–• –õ–ï–í–û ‚Üí –ü–†–ê–í–û
  {x:200,y:170},
  {x:290,y:170},
  {x:380,y:170},
  {x:470,y:170},

  // –ü–†–ê–í–ê–Ø –°–¢–û–†–û–ù–ê –í–ù–ò–ó
  {x:560,y:240},
  {x:560,y:310},
  {x:560,y:380},
  {x:560,y:450},

  // –ù–ò–ó –ü–†–ê–í–û ‚Üí –õ–ï–í–û
  {x:470,y:520},
  {x:380,y:520},
  {x:290,y:520},
  {x:200,y:520},

  // –î–û –ó–ê–ú–´–ö–ê–ù–ò–Ø
  {x:150,y:520},
  {x:130,y:520},
  {x:110,y:520}
];

function createToken(id,color){
  let el = document.createElement("div");
  el.className="token";
  el.id="p"+id;
  el.style.background=color;
  board.appendChild(el);
}

function moveToken(id,pos){
  let el=document.getElementById("p"+id);
  if(!el) return;
  el.style.transform=`translate(${positions[pos].x}px,${positions[pos].y}px)`;
}

socket.on("updatePlayers",players=>{
  players.forEach(p=>{
    if(!document.getElementById("p"+p.id)){
      createToken(p.id,p.color);
    }
    moveToken(p.id,p.position);
    if(p.id===myId){
      info.innerHTML="–•–∞–π–ø: "+p.hype;
    }
  });
});

rollBtn.onclick=()=>{
  socket.emit("rollDice");
};

socket.on("diceResult",num=>{
  let i=0;
  let anim=setInterval(()=>{
    dice.innerHTML=Math.floor(Math.random()*6)+1;
    i++;
    if(i>10){
      clearInterval(anim);
      dice.innerHTML=num;
    }
  },100);
});
</script>
</body>
</html>
