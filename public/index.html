<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Litvin Hype ULTIMATE</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="start">
<h2>Litvin Hype</h2>
<input id="name" placeholder="–ò–º—è">
<input id="room" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">

<div id="colors">
<div class="choice" data-color="red" style="background:red;"></div>
<div class="choice" data-color="blue" style="background:blue;"></div>
<div class="choice" data-color="green" style="background:green;"></div>
<div class="choice" data-color="yellow" style="background:yellow;"></div>
</div>

<button id="join">–ò–≥—Ä–∞—Ç—å</button>
</div>

<div id="game" style="display:none;">
<div id="board">
<div id="tokens"></div>
</div>

<div id="diceBox">
<div id="dice">üé≤</div>
<button id="rollBtn">–ë—Ä–æ—Å–∏—Ç—å</button>
</div>

<div id="info"></div>
</div>

<div id="modal"></div>

<script src="/socket.io/socket.io.js"></script>
<script>

const socket=io();
let myRoom=null;
let selectedColor=null;
let state=null;

const positions=[
{ x:113,y:588},{ x:108,y:464},{ x:108,y:345},{ x:108,y:235},{ x:108,y:135},
{ x:232,y:83},{ x:359,y:88},{ x:511,y:91},{ x:660,y:88},{ x:798,y:88},
{ x:920,y:119},{ x:903,y:243},{ x:901,y:351},{ x:895,y:461},{ x:895,y:580},
{ x:776,y:610},{ x:644,y:602},{ x:514,y:602},{ x:365,y:599},{ x:224,y:605}
];

// –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
document.querySelectorAll(".choice").forEach(c=>{
  c.onclick=()=>{
    document.querySelectorAll(".choice").forEach(x=>x.classList.remove("sel"));
    c.classList.add("sel");
    selectedColor=c.getAttribute("data-color"); // ‚Üê –ò–°–ü–†–ê–í–õ–ï–ù–û
  };
});

// –≤—Ö–æ–¥
join.onclick=()=>{
  const nameVal=document.getElementById("name").value.trim();
  const roomVal=document.getElementById("room").value.trim();

  if(!nameVal || !roomVal || !selectedColor){
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å—ë");
    return;
  }

  myRoom=roomVal;

  socket.emit("joinRoom",{
    name:nameVal,
    room:roomVal,
    color:selectedColor
  });

  document.getElementById("start").style.display="none";
  document.getElementById("game").style.display="block";
};

// –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
socket.on("state",s=>{
  state=s;
  render();
});

// –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
function render(){
  const layer=document.getElementById("tokens");
  layer.innerHTML="";

  state.players.forEach(p=>{
    const token=document.createElement("div");
    token.className="token";
    token.style.background=p.color;
    token.style.transform=`translate(${positions[p.position].x}px,${positions[p.position].y}px)`;
    layer.appendChild(token);
  });

  const current=state.players[state.turn];
  document.getElementById("info").innerHTML=
    "–•–æ–¥–∏—Ç: "+current.name;

  rollBtn.disabled=(current.id!==socket.id);
}

// –±—Ä–æ—Å–æ–∫
rollBtn.onclick=()=>{
  socket.emit("rollDice",myRoom);
};

// –∫—É–±–∏–∫
socket.on("roll",num=>{
  document.getElementById("dice").innerHTML="üé≤ "+num;
});

// —Å–∫–∞–Ω–¥–∞–ª
socket.on("scandal",text=>{
  const modal=document.getElementById("modal");
  modal.innerHTML="<div class='box'>"+text+"<br><button onclick='modal.style.display=\"none\"'>OK</button></div>";
  modal.style.display="flex";
});

// –ø–æ–±–µ–¥–∞
socket.on("winner",name=>{
  const modal=document.getElementById("modal");
  modal.innerHTML="<div class='box'>"+name+" –ø–æ–±–µ–¥–∏–ª! üèÜ</div>";
  modal.style.display="flex";
});

</script>
</body>
</html>
